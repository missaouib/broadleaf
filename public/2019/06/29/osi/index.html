<!DOCTYPE html>













<html class="theme-next mist" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/Han/3.3.0/han.min.css">
















  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.2',
    sidebar: {"position":"left","display":"remove","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型，是ISO（国际标准化组织）组织在1985年研究的网络互连模型。">
<meta name="keywords" content="osi">
<meta property="og:type" content="article">
<meta property="og:title" content="OSI参考模型">
<meta property="og:url" content="http://javachen.github.io/2019/06/29/osi/index.html">
<meta property="og:site_name" content="JavaChen Blog">
<meta property="og:description" content="OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型，是ISO（国际标准化组织）组织在1985年研究的网络互连模型。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://javachen.github.io/images/osi-1.png">
<meta property="og:image" content="http://www.ruanyifeng.com/blogimg/asset/201205/bg2012052909.png">
<meta property="og:image" content="http://www.ruanyifeng.com/blogimg/asset/201205/bg2012052910.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-2.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-3.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-4.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-5.gif">
<meta property="og:image" content="http://javachen.github.io/images/osi-6.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-7.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-8.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-9.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-10.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-11.png">
<meta property="og:image" content="http://javachen.github.io/images/osi-12.png">
<meta property="og:updated_time" content="2019-07-02T06:27:17.010Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OSI参考模型">
<meta name="twitter:description" content="OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型，是ISO（国际标准化组织）组织在1985年研究的网络互连模型。">
<meta name="twitter:image" content="http://javachen.github.io/images/osi-1.png">



  <link rel="alternate" href="/atom.xml" title="JavaChen Blog" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://javachen.github.io/2019/06/29/osi/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>OSI参考模型 | JavaChen Blog</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?50bc6f5d9b045b5895ff44f8bbdbc611";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JavaChen Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Ramblings of a coder</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://javachen.github.io/2019/06/29/osi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JavaChen">
      <meta itemprop="description" content="Rumblings by a coder on Java、Hadoop and so on">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JavaChen Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">OSI参考模型<a href="https://github.com/javachen/javachen-blog-theme/tree/master/source/_posts/2019/2019-06-29-osi.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pencil"></i></a>

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-29 00:00:00" itemprop="dateCreated datePublished" datetime="2019-06-29T00:00:00+08:00">2019-06-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-02 14:27:17" itemprop="dateModified" datetime="2019-07-02T14:27:17+08:00">2019-07-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <!--/删除
          
              <div class="post-description">
                  OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型，是ISO（国际标准化组织）组织在1985年研究的网络互连模型。
              </div>
          
          -->

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <h1 id="1、OSI参考模型"><a href="#1、OSI参考模型" class="headerlink" title="1、OSI参考模型"></a>1、OSI参考模型</h1><h2 id="1-1、OSI的来源"><a href="#1-1、OSI的来源" class="headerlink" title="1.1、OSI的来源"></a>1.1、OSI的来源</h2><p>OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型，是ISO（国际标准化组织）组织在1985年研究的网络互连模型。</p>
<p>ISO为了更好的使网络应用更为普及，推出了OSI参考模型。其含义就是推荐所有公司使用这个规范来控制网络。这样所有公司都有相同的规范，就能互联了。</p>
<h2 id="1-2、模型优点"><a href="#1-2、模型优点" class="headerlink" title="1.2、模型优点"></a>1.2、模型优点</h2><p>建立七层模型的主要目的是为解决异种网络互连时所遇到的兼容性问题。它的最大优点是将服务、接口和协议这三个概念明确地区分开来：服务说明某一层为上一层提供一些什么功能，接口说明上一层如何使用下层的服务，而协议涉及如何实现本层的服务；这样各层之间具有很强的独立性，互连网络中各实体采用什么样的协议是没有限制的，只要向上提供相同的服务并且不改变相邻层的接口就可以了。网络七层的划分也是为了使网络的不同功能模块（不同层次）分担起不同的职责，从而带来如下好处： 　　 </p>
<ul>
<li>减轻问题的复杂程度，一旦网络发生故障，可迅速定位故障所处层次，便于查找和纠错； 　　 </li>
<li>在各层分别定义标准接口，使具备相同对等层的不同网络设备能实现互操作，各层之间则相对独立，一种高层协议可放在多种低层协议上运行； 　　 </li>
<li>能有效刺激网络技术革新，因为每次更新都可以在小范围内进行，不需对整个网络动大手术； 　　 </li>
<li><p>便于研究和教学。</p>
<h2 id="1-3、模型的划分"><a href="#1-3、模型的划分" class="headerlink" title="1.3、模型的划分"></a>1.3、模型的划分</h2></li>
</ul>
<p>OSI分层 （7层）：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。</p>
<p>TCP/IP分层（4层）：物理层、 网络层、传输层、 应用层。</p>
<p>五层协议 （5层）：物理层、数据链路层、网络层、传输层、 应用层。</p>
<p>OSI定义了网络互连的七层框架，即ISO开放互连系统参考模型，如下图：</p>
<p><img src="/images/osi-1.png" alt="img"></p>
<p>每一层实现各自的功能和协议，并完成与相邻层的接口通信。OSI的服务定义详细说明了各层所提供的服务。某一层的服务就是该层及其下各层的一种能力，它通过接口提供给更高一层。各层所提供的服务与这些服务是怎么实现的无关。</p>
<h2 id="1-4、各层功能定义"><a href="#1-4、各层功能定义" class="headerlink" title="1.4、各层功能定义"></a>1.4、各层功能定义</h2><h3 id="1-4-1-物理层（Physical-Layer）"><a href="#1-4-1-物理层（Physical-Layer）" class="headerlink" title="1.4.1 物理层（Physical Layer）"></a>1.4.1 物理层（Physical Layer）</h3><p>OSI 模型的最低层或第一层，作用就是通过物理手段把电脑连接起来，它主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等，它的主要作用是传输比特流（就是由1、0转化为电流强弱来进行传输,到达目的地后在转化为1、0，也就是我们常说的数模转换与模数转换）。<strong>在这一层，数据还没有被组织，仅作为原始的位流或电气电压处理，单位是比特。</strong></p>
<p>物理层有：RJ45、CLOCK、IEEE802.3 （中继器，集线器，网关，调制解调器，网线，双绞线，同轴电缆） </p>
<h3 id="1-4-2-数据链路层（Datalink-Layer）"><a href="#1-4-2-数据链路层（Datalink-Layer）" class="headerlink" title="1.4.2 数据链路层（Datalink Layer）"></a>1.4.2 数据链路层（Datalink Layer）</h3><h4 id="1-4-2-1、定义"><a href="#1-4-2-1、定义" class="headerlink" title="1.4.2.1、定义"></a><strong>1.4.2.1、定义</strong></h4><p>物理层就是传输电路的0和1信号的，但是单纯的0和1没有意义，必须规定解读方式：多少个0和1算一组？每个信号有什么意义？——<strong>这就是链路层的意义，它在物理层的上方，将比特组合成字节，再将字节组合成帧，使用链路层地址 (以太网使用MAC地址)来访问介质，并进行差错检测但不能纠正。</strong></p>
<p>数据链路层有：PPP、FR、STP、SDLC、HDLC、VLAN、MAC （网桥，交换机，帧中继）</p>
<h4 id="1-4-2-2、以太网协议"><a href="#1-4-2-2、以太网协议" class="headerlink" title="1.4.2.2、以太网协议"></a><strong>1.4.2.2、以太网协议</strong></h4><p>早些时候，各个公司都有自己的电信号分组方式，后来出现了“以太网”<strong>这种协议逐渐占据了主导的地位。</strong>“以太网”<strong>规定，</strong>一组电信号构成一个数据包，叫做“帧（Frame）”；每一帧分成两个个部分：标头（Head）和数据（Data）。<br>因此，数据链路层链路层的数据包就叫“以太网数据包”，他由“标头”和“数据”两部分组成——其中，<strong>“标头”包含数据包的一些说明项，比如发送者、接受者、数据类型等等。</strong></p>
<h4 id="1-4-2-3、MAC地址"><a href="#1-4-2-3、MAC地址" class="headerlink" title="1.4.2.3、MAC地址"></a><strong>1.4.2.3、MAC地址</strong></h4><p>以太网规定，连入网络的所有设备，都必须具有“网卡”接口。数据包必须是从一块网卡，传送到另一块网卡，网卡的地址，就是数据包的发送地址和接受地址，也叫<strong>MAC地址</strong>。</p>
<p>每块网卡出厂的时候，都有全世界独一无二的MAC地址，长度是48位的二进制，通常用12个十六进制数表示。</p>
<p><strong>前6个十六进制是厂商编号，后6个是该厂商的网卡流水号</strong>，有了MAC地址，就可以定位网卡和数据包的路径了。</p>
<h4 id="1-4-2-4、广播"><a href="#1-4-2-4、广播" class="headerlink" title="1.4.2.4、广播"></a><strong>1.4.2.4、广播</strong></h4><p>一块网卡怎么只带另一块网卡的MAC地址？以太网采用了一种很”原始”的广播式的方式，<strong>它不是把数据包准确送到接收方，而是向本网络（局域网）内所有计算机发送，让每台计算机自己判断，是否为接收方</strong>。<br>一台计算机向本局域网内的所有电脑均发送相同的数据包，其他计算机收到这个数据包之后，会读取这个数据包的“标头”，找到其中接收方（目标方）的MAC地址，然后与自身的MAC地址进行比对，如果两者相同，说明就是要发给自己的，然后接受这个包并做出进一步的处理，否则丢弃这个包。<strong>这种发送方式就叫“广播”，主要通过分组交换机或者网络交换机进行。</strong></p>
<h3 id="1-4-3、网络层（Network-Layer）"><a href="#1-4-3、网络层（Network-Layer）" class="headerlink" title="1.4.3、网络层（Network Layer）"></a>1.4.3、网络层（Network Layer）</h3><p>根据上面的讲解，理论上依靠MAC地址和广播技术，上海的网卡发出的数据包就可以找到洛杉矶网卡了——但是如果全世界的计算机都这么干，那么每一台计算机发出的数据包都同步广播到全世界其他电脑，再一一比对判断，这样显然是低效、不现实的。<br>   <br>因此，上面我们强调，广播是在发送者所在的局域网内广播的，不同也就是说，如果两台计算机没有在同一个子网（局域网）内，是无法通过广播直接传过去的。前面我们说过，互联网是由一个个子网组成的更大的子网，一级一级组网，最终构成的互联网。<br>   <br>因此我们必须找到一种方法，区分哪些MAC地址属于同一个子网。如果是同一个子网就采用广播的形式，如果不是，则采用“路由”的方式（后面会讲）发送——这就导致了<strong>网络层的出现，他的作用是引入一套新的地址，使我们能够区分哪些计算机属于同一个子网，这个套机制就叫做“网络地址”，也就是“IP地址”</strong>。</p>
<p>网络层通过IP寻址来建立两个节点之间的连接，为源端的运输层送来的分组，选择合适的路由和交换节点，正确无误地按照地址传送给目的端的运输层，就是通常说的IP层。</p>
<p>网络层有：IP、ICMP、IGMP、ARP、RARP、OSPF、IPX、RIP、BGP、IPSec、GRE、IGRP（路由器）</p>
<h4 id="1-4-3-1、IP协议"><a href="#1-4-3-1、IP协议" class="headerlink" title="1.4.3.1、IP协议"></a>1.4.3.1、IP协议</h4><p>网络地址由32个二进制位组成，习惯上，我们分成四段十进制数表示IPV4地址，从0.0.0.0到255.255.255.255。</p>
<p>互联网上的每一台计算机，都会被分配到一个IP地址，这个地址由两部分组成，前一部分代表网络，后一部分代表主机（又称终端）。</p>
<h4 id="1-4-3-2、子网掩码"><a href="#1-4-3-2、子网掩码" class="headerlink" title="1.4.3.2、子网掩码"></a>1.4.3.2、子网掩码</h4><p>单从IP地址，我们无法判断两台计算机是否处于同一个网络，这时候需要子网掩码。<strong>所谓”子网掩码”，就是表示子网络特征的一个参数，它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。</strong></p>
<p>知道”子网掩码”，我们就能判断，任意两个IP地址是否处在同一个子网络。方法是<strong>将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。</strong></p>
<h4 id="1-4-3-3、IP数据包"><a href="#1-4-3-3、IP数据包" class="headerlink" title="1.4.3.3、IP数据包"></a>1.4.3.3、<strong>IP数据包</strong></h4><p>根据IP协议发送的数据，就叫做IP数据包。不难想象，其中必定包括IP地址信息。</p>
<p>但是前面说过，以太网数据包只包含MAC地址，并没有IP地址的栏位。那么是否需要修改数据定义，再添加一个栏位呢？</p>
<p>回答是不需要，我们可以把IP数据包直接放进以太网数据包的”数据”部分，因此完全不用修改以太网的规格。这就是互联网分层结构的好处：上层的变动完全不涉及下层的结构。</p>
<p>具体来说，IP数据包也分为”标头”和”数据”两个部分。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/201205/bg2012052909.png" alt="img"></p>
<p>“标头”部分主要包括版本、长度、IP地址等信息，”数据”部分则是IP数据包的具体内容。它放进以太网数据包后，以太网数据包就变成了下面这样。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/201205/bg2012052910.png" alt="img"></p>
<p>IP数据包的”标头”部分的长度为20到60字节，整个数据包的总长度最大为65,535字节。因此，理论上，一个IP数据包的”数据”部分，最长为65,515字节。前面说过，以太网数据包的”数据”部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。</p>
<h4 id="1-4-3-4、路由-路由器-网关-交换机"><a href="#1-4-3-4、路由-路由器-网关-交换机" class="headerlink" title="1.4.3.4、路由/路由器/网关/交换机"></a>1.4.3.4、路由/路由器/网关/交换机</h4><p>上面我们已经确定了两台计算机是否遭同一个子网中，如果在，则采用广播+MAC寻址的的方式发送数据包，如果不是，则要采用“路由”的方式了，那么什么是“路由”呢？</p>
<h5 id="路由"><a href="#路由" class="headerlink" title="路由"></a><strong>路由</strong></h5><p><strong>就是通过互联的网络把信息从源地址传输到目的地址的活动。路由引导分组转送，经过一些中间的节点后，到它们最后的目的地。</strong></p>
<p>从“路由”的定义中可以看到，“路由”是一种活动，一种动作，一种行为，作用是是将信息从原地址传输到目的地址，<strong>比较特殊的是，原地址和目标地址是在两个不同的子网中的</strong>。那么如何传输呢？路由定义一条路径，经过因特网发送包到另一网络上的地址，但路由不定义完全路径，只定义从主机到可以将包转发到目的地的网关（子网）间的路径段（或从一个子网到另一个子网）。</p>
<h5 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a><strong>路由器</strong></h5><p><strong>简单理解就是实现路由功能的机器。路由器连接两个或多个网络并提供路由功能。</strong></p>
<p>前面我们说过，网卡是计算机的一个硬件，它在接收到网路信息之后，将信息交给计算机。当计算机需要发送信息的时候，也要通过网卡发送。<strong>一台计算机可以有不只一个网卡，比如笔记本就有一个以太网卡和一个WiFi网卡。</strong>计算机在接收或者发送信息的时候，要先决定想要通过哪个网卡。<strong>路由器可以通俗理解为一台配备有多个网卡的专用电脑，它让网卡接入到不同的网络中。</strong></p>
<h5 id="网关"><a href="#网关" class="headerlink" title="网关"></a><strong>网关</strong></h5><p>是路由器的一种，通常我们把<strong>网络层使用的路由器称为网关</strong>，路由器可以在网络接口级或物理级路由；网关是在网络层上路由（个人感觉应该是一种概念，即在网络层连节两个子网的概念，并不存在实体，真正实现路由功能还是得靠路由器）。</p>
<p>说的再通俗一点，路由器上面有MAC地址和MAC地址对应的IP，而网关由于是网络层的概念因此只有IP地址。在今天很多局域网采用都是路由来接入网络，因此<strong>现在通常指的网关就是路由器的IP。</strong></p>
<p>另外，需要强调一点，虽然路由器上面有MAC地址和IP地址，但<strong>它并不能通过MAC地址工作，必须通过IP寻址，因为它是工作在网络层的设备。</strong></p>
<h5 id="网络交换机"><a href="#网络交换机" class="headerlink" title="网络交换机"></a><strong>网络交换机</strong></h5><p>是一个扩大网络的器材，能为子网中提供更多的连接端口，以便连接更多的电脑。交换机与路由器的区别：</p>
<ul>
<li><strong>工作层次不同</strong><br>交换机主要工作在数据链路层（第二层）<br>路由器工作在网络层（第三层）。</li>
<li><strong>转发依据不同</strong><br>交换机转发所依据的对象是：MAC地址。（物理地址）<br>路由转发所依据的对象是：IP地址。（网络地址）</li>
<li><strong>主要功能不同</strong><br>交换机主要用于组建局域网，连接同属于一个(广播域)子网的所有设备，负责子网内部通信（广播）。<br>路由主要功能是将由交换机组好的局域网相互连接起来，或者将他们接入Internet。<br>交换机能做的，路由都能做。<br>交换机不能分割广播域（子网），路由可以。<br>路由还可以提供防火墙的功能。<br>路由配置比交换机复杂。</li>
</ul>
<p>这里我们还是需要说明一点：</p>
<p>交换机虽然主要依靠MAC地址查找工作在数据链路层，但是他也可以有IP地址，这样就可以进行远程登录等操作了。</p>
<p> <strong>LAN</strong>，全称Local Area Network，中文名叫做<strong>局域网</strong>；<strong>WAN</strong>，全称Wide Area Network，中文名叫做<strong>广域网</strong>。WAN是一种跨越大的、地域性的计算机网络的集合。通常跨越省、市，甚至一个国家。广域网包括大大小小不同的子网，子网可以是局域网，也可以是小型的广域网；<strong>WLAN</strong>，全称Wireless LAN, <strong>无线局域网</strong>，通俗点讲就是WiFi。</p>
<p>家用的路由器，一般包括了交换机和路由器，因此他有两个接口——WAN端口用于连接至Internet；LAN端口用于连接至局域网设备。</p>
<h5 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h5><p>下图中位于中间位置的路由器有两个接口IP，地址分别为199.165.145.17和199.165.146.3。它们分别接入到两个网络：199.165.145和199.165.146。</p>
<p><img src="/images/osi-2.png" alt="img"></p>
<p>显然，199.165.145和199.165.146是两个不同的子网，他们通过中间的路由器连接节，这个路由器有两个网卡：199.165.145.17和199.165.146.3。</p>
<p>现在考虑一种情况，我们从主机145.17生成发送到146.21的IP包:</p>
<p><strong>第一步：</strong>先写好数据包的标头，即<strong>写清楚发送者的IP地址（199.165.145.17）和接受者的IP地址（199.165.146.21）</strong>，145.17会参照自己的路由表：</p>
<p><img src="/images/osi-3.png" alt="img"></p>
<p>第一行表示，如果IP目的地是199.165.145.0这个网络中的主机，那么说明是在同一个子网中，只需要用自己在eth0上的网卡（MAC地址）通过交换机直接传送，不需要前往路由器。<br>第二行表示所有不符合第一行的IP目的地，则应该送往送往199.165.145.17这个网关，也就是中间router接入在eth0的网卡IP地址。<br>我们的IP包目的地为199.165.146.21，不符合第一行，所以按照第二行，发送到中间的router。主机145.17会在数据包的头部写上199.165.145.17对应的MAC地址，这样，就在199.165.145这个局域网中通过交换机（通过广播MAC地址）广播到199.165.145.17对应的主机（路由器）。</p>
<p><strong>第二步：</strong>中间的router在收到IP包之后，提取目的地IP地址，然后对照自己的routing table：</p>
<p><img src="/images/osi-4.png" alt="img"></p>
<p>从前两行我们看到，由于router横跨eth0和eth1两个网络，它可以直接通过eth0和eth1上的网卡直接传送IP包。第三行表示，如果是前面两行之外的IP地址，则需要通过eth1，送往199.165.146.8(右边的router接口IP)。我们的目的地符合第二行，所以将IP放入一个新的帧中，在帧的头部写上199.165.146.21的MAC地址，通过199.165.146网中的交换机广播发往主机146.21。</p>
<p>IP包可以进一步接力，到达更远的主机。IP包从主机出发，根据沿途路由器的routing table指导，在router间接力。<strong>IP包最终到达某个router，这个router与目标主机位于一个局域网中，可以直接建立数据链路层的（广播）通信</strong>。最后，IP包被送到目标主机。这样一个过程叫做routing。</p>
<p>整个过程中，IP包不断被主机和路由封装入帧(信封)并拆开，然后借助连接层，在局域网的各个网卡之间传送帧。整个过程中，我们的IP包的内容保持完整，没有发生变化。最终的效果是一个IP包从一个主机传送到另一个主机。<strong>利用IP包，我们不需要去操心底层(比如数据链路层)发生了什么</strong>。</p>
<h4 id="1-4-3-5-ARP协议"><a href="#1-4-3-5-ARP协议" class="headerlink" title="1.4.3.5 ARP协议"></a>1.4.3.5 ARP协议</h4><p>因为IP数据包是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的MAC地址，另一个是对方的IP地址。通常情况下，对方的IP地址是已知的（后文会解释），但是我们不知道它的MAC地址。所以，我们需要一种机制，能够从IP地址得到MAC地址。</p>
<p>这里又可以分成两种情况。</p>
<p>第一种情况，如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的”网关”（gateway），让网关去处理。</p>
<p>第二种情况，如果两台主机在同一个子网络，那么我们可以用ARP协议，得到对方的MAC地址。ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，在对方的MAC地址这一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个”广播”地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身的IP地址进行比较。如果两者相同，都做出回复，向对方报告自己的MAC地址，否则就丢弃这个包。</p>
<p>总之，有了ARP协议之后，我们就可以得到同一个子网络内的主机MAC地址，可以把数据包发送到任意一台主机之上了。</p>
<h3 id="1-4-4、传输层（Transport-Layer）"><a href="#1-4-4、传输层（Transport-Layer）" class="headerlink" title="1.4.4、传输层（Transport Layer）"></a>1.4.4、传输层（Transport Layer）</h3><p>传输层建立了主机端口到端口的链接，作用是为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信的细节，使高层用户看到的只是在两个传输实体间的一条主机到主机的、可由用户控制和设定的、可靠的数据通路。</p>
<p>传输层有：TCP、UDP、SPX等，数据包一旦离开网卡即进入了网络传输层。</p>
<h4 id="1-4-4-1、端口"><a href="#1-4-4-1、端口" class="headerlink" title="1.4.4.1、端口"></a>1.4.4.1、端口</h4><p>有了MAC地址和IP地址，我们已经可以在互联网上的任意两台电脑之间建立通信了。接下来的问题是，同一台主机上许多程序（进程）都需要用到网络，比如你一遍浏览网页一遍聊天。<strong>当一个数据包从网上发送过来的时候，我们需要一个参数来区分，他到底是提供哪个进程使用的——这个参数就叫做“端口号”，他其实就是每一个使用网卡的程序的编号。</strong>每个数据包发送到主机特定的端口，所以不同的程序就能取到自己想要的数据包。</p>
<p><strong>端口是0到65535之间的一个整数，正好16个二进制。0~1023的端口被系统占用，用户只能使用大于1023的端口。不管是浏览网页还是聊天，应用程序都会随机选用一个端口，然后与服务器简历相应的端口关系。</strong></p>
<p><strong>“传输层”的功能，就是建立“端口到端口”之间的通信。相比之下，“网络层”的功能是建立“主机到主机”的通信。</strong>只要确定主机和端口号，我们就能实现程序之间的交流。</p>
<h4 id="1-4-4-2、Socket"><a href="#1-4-4-2、Socket" class="headerlink" title="1.4.4.2、Socket"></a>1.4.4.2、Socket</h4><p>传输层是建立“端口到端口”之间的通信，更具体一点，也就是程序和程序之间的通信，或者<strong>“进程间通信”</strong>。</p>
<p>进程间通信分为两种：一种是<strong>主机内部（或终端内部）进程间通信</strong>，这个由终端或主机上的操作系统决定，比如在Android系统上面进程间通信就是<strong>AIDL</strong>；另一种是<strong>跨主机进程间通信或者网络进程间通信</strong>，也叫<strong>“socket通信”</strong>。我们可以先笼统的理解——Unix系统把主机+端口，叫做”套接字”（socket），当然，这样说是有失偏颇的。</p>
<h5 id="那么，Socket是什么？"><a href="#那么，Socket是什么？" class="headerlink" title="那么，Socket是什么？"></a><strong>那么，Socket是什么？</strong></h5><ul>
<li><p><strong>从编程语言的角度，socket是一个无符号整型变量，用来标识一个通信进程</strong>。两个进程通信，总要知道这几个信息：双方的ip地址和端口号，通信所采用的协议栈。socket就是和这些东西绑定的，实现socket可以使用unix提供的接口，也可以使用wIndows提供的winSock。</p>
</li>
<li><p><strong>socket本质是编程接口(API)，对TCP/IP的封装。TCP/IP只是一个协议栈，必须要具体实现，同时还要提供对外的操作接口（API），这就是Socket接口</strong>。通过Socket,我们才能使用TCP/IP协议，因此有了一系列我们知道的函数接口——connect、accept、send、read、write等。</p>
</li>
</ul>
<p>JDK的java.net包下有两个类：Socket和ServerSocket，在Client和Server建立连接成功后，两端都会产生一个Socket实例，操作这个实例，完成所需的会话，而程序员就通过这些API进行网络编程。 Socket连接过程分为三个步骤：服务器监听，客户端请求，连接确认。</p>
<h4 id="1-4-4-3、UDP-TCP协议"><a href="#1-4-4-3、UDP-TCP协议" class="headerlink" title="1.4.4.3、UDP/TCP协议"></a>1.4.4.3、UDP/TCP协议</h4><p>UDP和TCP协议都是传输层的协议，他们的主要作用就是在应用层的数据包标头加上端口号（或者在IP协议的数据包中插入端口号）。</p>
<ul>
<li>UDP协议的优点是比较简单，容易实现，但是缺点是可靠性较差，一旦数据包发出，无法知道对方是否收到。</li>
<li>TCP协议可以近似认为是有确认机制的UDP协议。每发出一个数据包都要求确认。如果有一个数据包遗失，就收不到确认，发出方就知道有必要重发这个数据包了。</li>
</ul>
<p>TCP协议主要的确认机制是<strong>“三次握手，四次挥手”</strong>。</p>
<h3 id="1-4-5、会话层（Session-Layer）"><a href="#1-4-5、会话层（Session-Layer）" class="headerlink" title="1.4.5、会话层（Session Layer）"></a>1.4.5、会话层（Session Layer）</h3><p>会话层就是负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。</p>
<p>会话层的功能包括：建立通信链接，保持会话过程通信链接的畅通，同步两个节点之间的对话，决定通信是否被中断以及通信中断时决定从何处重新发送。 　　</p>
<p>你可能常常听到有人把会话层称作网络通信的“交通警察”。当通过拨号向你的 ISP （因特网服务提供商）请求连接到因特网时，ISP 服务器上的会话层向你与你的 PC 客户机上的会话层进行协商连接。若你的电话线偶然从墙上插孔脱落时，你终端机上的会话层将检测到连接中断并重新发起连接。会话层通过决定节点通信的优先级和通信时间的长短来设置通信期限。</p>
<p>会话层：NFS、SQL、NETBIOS、RPC。</p>
<h3 id="1-4-6、表示层（Presentation-Layer）"><a href="#1-4-6、表示层（Presentation-Layer）" class="headerlink" title="1.4.6、表示层（Presentation Layer）"></a>1.4.6、表示层（Presentation Layer）</h3><p>表示层提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。如果必要，该层可提供一种标准表示形式，用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。数据压缩和加密也是表示层可提供的转换功能之一。</p>
<p>表示层有：JPEG、ASCll、DECOIC、加密格式等。</p>
<p>应用程序和网络之间的翻译官，在表示层，数据将按照网络能理解的方案进行格式化；这种格式化也因所使用网络的类型不同而不同。 　　</p>
<p>表示层管理数据的解密与加密，如系统口令的处理。例如：在 Internet上查询你银行账户，使用的即是一种安全连接。你的账户数据在发送前被加密，在网络的另一端，表示层将对接收到的数据解密。除此之外，表示层协议还对图片和文件格式信息进行解码和编码。</p>
<h3 id="1-4-7、应用层（Application-Layer）"><a href="#1-4-7、应用层（Application-Layer）" class="headerlink" title="1.4.7、应用层（Application Layer）"></a>1.4.7、应用层（Application Layer）</h3><p>应用层是最靠近用户的OSI层。这一层为用户的应用程序（例如电子邮件、文件传输和终端仿真）提供网络服务。<br>应用层有：DHCP、HTTP、WWW、HTTPS、FTP、TFTP、NFS、SMTP、SNMP、POP3、P2P、DNS、TELNET、GTP等。</p>
<p>请求头：http1.1、POST、URL、正文格式(content-type)、长度(content-length)</p>
<p>请求参数：购买的产品信息、数量</p>
<h4 id="1-4-7-1、DNS"><a href="#1-4-7-1、DNS" class="headerlink" title="1.4.7.1、DNS"></a>1.4.7.1、DNS</h4><p>域名名称系统，端口53，是互联网的一项服务。<strong>它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网</strong>。</p>
<p>网络中的数据包，是通过<strong>“端口号+IP地址+MAC地址”</strong>来识别目的地址的，也就是说定位一个主机的时候，我们是定位的是他的IP地址。当我们在浏览器输入一个域名的时候，DNS服务器会根据域名找到对应的IP地址返回给客户端。</p>
<h4 id><a href="#" class="headerlink" title></a><img src="/images/osi-5.gif" alt="img"></h4><h2 id="1-5、一个网络数据包的传输过程"><a href="#1-5、一个网络数据包的传输过程" class="headerlink" title="1.5、一个网络数据包的传输过程"></a>1.5、一个网络数据包的传输过程</h2><p>首先我们设置了本机参数：</p>
<ul>
<li><strong>本机IP地址：192.168.1.100</strong></li>
<li><strong>子网掩码：255.255.255.0</strong></li>
<li><strong>网关的IP地址：192.168.1.1</strong></li>
<li><strong>DNS的IP地址：8.8.8.8</strong></li>
</ul>
<p>然后打开浏览器访问谷歌的网址：<a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a> ，按下回车。这意味着，浏览器要向Google发送一个网页请求的数据包。</p>
<p><strong>第一步：</strong>DNS查询。在浏览器DNS中搜索、在操作系统DNS中搜索、读取系统hosts文件，查找其中是否有对应的ip、向本地配置的首选DNS服务器发起域名解析请求，得到Google的IP地址是172.194.72.105。</p>
<p><strong>第二步：</strong>客户端浏览器组成应用层数据包，包括请求头和请求体，发送HTTP请求。我们假定这个部分的长度为4960字节，此时的数据包结构如下：</p>
<p><img src="/images/osi-6.png" alt="img"></p>
<p> <strong>第三步：</strong>建立TCP连接。在传输层，TCP/UDP数据包需要设置端口，接收方（Google）的HTTP端口默认是80，发送方（本机）的端口是一个随机生成的1024-65535之间的整数。<strong>TCP数据包的标头长度为20字节</strong>，加上嵌入HTTP的数据包，总长度变为4980字节。</p>
<p><img src="/images/osi-7.png" alt="img"></p>
<p> <strong>第四步：</strong>在网络层，TCP数据包再嵌入IP数据包。IP数据包需要设置双方的IP地址，发送方是192.168.1.100（本机），接收方是172.194.72.105（Google）。IP数据包的标头长度为20字节，加上嵌入的TCP数据包，总长度变为5000字节。</p>
<p><img src="/images/osi-8.png" alt="img"></p>
<p><strong>第五步</strong>：客户端的链路层，包通过链路层发送到路由器，通过邻居协议查找给定IP地址的MAC地址，然后发送ARP请求查找目的MAC地址。通过子网掩码可以知道Google与本机不在同一个子网络，因此，我们要向Google发送数据包，必须通过网关192.168.1.1转发，也就是说，接收方的MAC地址将是网关192.168.1.1的MAC地址。</p>
<p><strong>以太网数据包的数据部分，最大长度为1500字节</strong>，而现在的IP数据包长度为5000字节。因此，IP数据包必须分割成四个包。因为每个包都有自己的IP标头（20字节），所以四个包的IP数据包的长度分别为1500、1500、1500、560。</p>
<p><img src="/images/osi-9.png" alt="img"></p>
<p>分割成四个数据包，分割只能分割数据部分，每个数据包都要具有相同的标头，不然找不到目的地址：</p>
<p><img src="/images/osi-10.png" alt="img"></p>
<p>总结起来，数据封装过程：</p>
<p><img src="/images/osi-11.png" alt="image.png"></p>
<p><img src="/images/osi-12.png" alt="image.png"></p>
<p><strong>第六步</strong>：响应http请求。经过多个网关的转发，Google的服务器172.194.72.105，收到了这四个以太网数据包。根据IP标头的序号，Google将四个包拼起来，取出完整的TCP数据包，然后读出里面的”HTTP请求”，接着做出”HTTP响应”，再用TCP协议发回来。</p>
<p><strong>第七步</strong>：浏览器解析html。</p>
<p><strong>第八步</strong>：断开TCP链接。</p>
<p>模拟过程如下：</p>
<p>GET <a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a></p>
<ul>
<li>7：应用层 <a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a> IP:80<ul>
<li>http、smtp、ssh</li>
</ul>
</li>
<li>4：传输层控制：三次握手&gt;传输数据&gt;四次挥手<ul>
<li>tcp、udp</li>
<li>socket   IP:PORT-IP:PORT <ul>
<li>netstat -natp</li>
</ul>
</li>
</ul>
</li>
<li>3：网络层 <ul>
<li>ip、ICMP</li>
<li>ROUTE：下一跳<ul>
<li>route -n</li>
</ul>
</li>
</ul>
</li>
<li>2：链路层<ul>
<li>以太网 Ethernet：MAC</li>
<li>ARP：全F，两点通信，交换机学习</li>
<li>arp -a</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.0.2.2        0.0.0.0         UG    100    0        0 enp0s3</span><br><span class="line">10.0.2.0        0.0.0.0         255.255.255.0   U     100    0        0 enp0s3</span><br><span class="line">192.168.56.0    0.0.0.0         255.255.255.0   U     100    0        0 enp0s8</span><br></pre></td></tr></table></figure>
<h3 id="1-4-9、总结"><a href="#1-4-9、总结" class="headerlink" title="1.4.9、总结"></a>1.4.9、总结</h3><p>每一层的作用如下：</p>
<ul>
<li><p>物理层：通过媒介传输比特，确定机械及电气规范（比特Bit）。负责把逐个的比特从一跳（结点）移动到另一跳（结点）。对应设备：网卡，网线，集线器，中继器，调制解调器 。</p>
</li>
<li><p>数据链路层：将比特组装成帧和点到点的传递（帧Frame）。在局域网内部实现主机与主机之间的通讯。对应设备：网桥，交换机。</p>
</li>
<li><p>网络层：负责数据包从源到宿的传递和网际互连（包PackeT）。对应设备：路由器。</p>
</li>
<li><p>传输层：提供端到端的可靠报文传递和错误恢复（段Segment）。对应设备：网关、防火墙。</p>
</li>
<li><p>会话层：建立、管理和终止会话（会话协议数据单元SPDU）</p>
</li>
<li><p>表示层：对数据进行翻译、加密和压缩（表示协议数据单元PPDU）</p>
</li>
<li><p>应用层：允许访问OSI环境的手段（应用协议数据单元APDU）</p>
</li>
</ul>
<h1 id="2、TCP-IP四层模型"><a href="#2、TCP-IP四层模型" class="headerlink" title="2、TCP/IP四层模型"></a>2、TCP/IP四层模型</h1><p>TCP/IP和OSI模型组并不能精确的匹配，但是我们可以尽可能的参考OSI模型并在其中找到TCP/IP的对应位置。如上图所示，我们已经标出了TCP/IP对应的四层位置所在。<strong>通常人们认为OSI模型最上面三层（应用层、表示层、会话层）在TCP/IP中是一个应用层</strong>。由于TCP/IP有一个相对比较弱的会话层，由TCP和RTP下的打开和关闭连接组成，并在TCP/UDP下的各种应用提供不同的端口号，这些功能被单个的应用程序添加。</p>
<h1 id="3、参考文章"><a href="#3、参考文章" class="headerlink" title="3、参考文章"></a>3、参考文章</h1><ul>
<li><a href="https://blog.51cto.com/13055758/2061535" target="_blank" rel="noopener">OSI七层模型、数据封装与解封装过程、TCP三次握手、四次挥手</a></li>
<li><a href="https://www.jianshu.com/p/c793a279f698" target="_blank" rel="noopener">计算机网络漫谈：OSI七层模型与TCP/IP四层（参考）模型</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html" target="_blank" rel="noopener">互联网协议入门（一）</a></li>
</ul>

      
    </div>

    

    
    
    


    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>JavaChen</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="http://javachen.github.io/2019/06/29/osi/" title="OSI参考模型">OSI参考模型</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-Hans" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.jpg" alt="JavaChen 微信支付">
        <p>微信支付</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/alipay.jpg" alt="JavaChen 支付宝">
        <p>支付宝</p>
      </div>
    

  </div>
</div>

      </div>
    



    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/osi/" rel="tag"><i class="fa fa-tag"></i> osi</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
            
            
              <div>
                
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

              </div>
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/29/nginx/" rel="next" title="Nginx服务器">
                <i class="fa fa-chevron-left"></i> Nginx服务器
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/06/29/jsf/" rel="prev" title="Java Server Faces">
                Java Server Faces <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2009 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JavaChen</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script>

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.2"></script>




  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').not('.gist .highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      const selection = document.getSelection();
      const selected = selection.rangeCount > 0 ? selection.getRangeAt(0) : false;
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
      ta.blur(); // For iOS
      $(this).blur();
      if (selected) {
        selection.removeAllRanges();
        selection.addRange(selected);
      }
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
